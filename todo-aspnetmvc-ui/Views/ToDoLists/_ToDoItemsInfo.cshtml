@using todo_aspnetmvc_ui.Infrastructure
@using System.ComponentModel.DataAnnotations;
@using Newtonsoft.Json;

@model IEnumerable<ToDoEntry>

@{
    var orderedToDoItems = Model.OrderBy(entry => entry.OrdinalNumber);
}

<div>
    <table class="table table-hover">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Title</th>
                <th scope="col">Due date</th>
                <th scope="col">Status</th>
                <th scope="col">Description</th>
                <th scope="col">Notes</th>
                <th scope="auto">Actions</th>
            </tr>
        </thead>

        <tbody>
            @foreach (var todoItem in orderedToDoItems)
            {
            <tr>
                <th scope="row">@todoItem.OrdinalNumber</th>
                <td>@todoItem.Title</td>
                <td>@todoItem.DueDate</td>
                <td>@(todoItem.Status.GetAttribute<DisplayAttribute>().Name)</td>
                <td>@todoItem.Description</td>
                <td>@(string.IsNullOrEmpty(todoItem.Notes) ? "-" : todoItem.Notes)</td>
                <td>
                    <button type="button" class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editItem@(todoItem.Id)">
                        Edit
                    </button>
                    <partial name="_EditToDoItem" model="@todoItem" />
                    <button type="button" class="btn btn-outline-danger btn-sm" data-bs-toggle="modal" data-bs-target="#removeItem@(todoItem.Id)">
                        Remove
                    </button>
                    <form method="post" asp-controller="ToDoLists" asp-action="DeleteToDoItem">
                        <input type="hidden" asp-for="@todoItem.Id" />
                        <input type="hidden" name="todoListId" value="@todoItem.ToDoList.Id" />
                        <dlg id="removeItem@(todoItem.Id)" title="Remove ToDo item">
                            Are you sure to want to completely remove this ToDo item?
                        </dlg>
                    </form>
                </td>
            </tr>
            }
        </tbody>
    </table>    
</div>