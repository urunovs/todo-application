@using todo_aspnetmvc_ui.Infrastructure
@using System.ComponentModel.DataAnnotations;
@using Newtonsoft.Json;

@model IEnumerable<ToDoEntry>

@{
    var orderedToDoItems = Model.OrderBy(entry => entry.OrdinalNumber);
}

<div>
    <table class="table table-hover">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Title</th>
                <th scope="col">Due date</th>
                <th scope="col">Status</th>
                <th scope="col">Description</th>
                <th scope="col">Notes</th>
                <th scope="auto">Actions</th>
            </tr>
        </thead>

        <tbody>
            @foreach (var todoItem in orderedToDoItems)
            {
            <tr>
                <th scope="row">@todoItem.OrdinalNumber</th>
                <td>@todoItem.Title</td>
                <td>@todoItem.DueDate</td>
                <td>@(todoItem.Status.GetAttribute<DisplayAttribute>().Name)</td>
                <td>@todoItem.Description</td>
                <td>@todoItem.Notes</td>
                <td>
                    <button type="button" class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editItem@(todoItem.Id)">
                        Edit
                    </button>
                    <partial name="_EditToDoItem" model="@todoItem" />
                    <button type="button" class="btn btn-outline-danger btn-sm" data-bs-toggle="modal" data-bs-target="#removeItem@(todoItem.Id)">
                        Remove
                    </button>
                    <form method="post" asp-controller="ToDoLists" asp-action="DeleteToDoItem">
                        <input type="hidden" asp-for="@todoItem.Id" />
                        <input type="hidden" name="todoListId" value="@todoItem.ToDoList.Id" />
                        <dlg id="removeItem@(todoItem.Id)" title="Remove ToDo item">
                            Are you sure to want to completely remove this ToDo item?
                        </dlg>
                    </form>
                </td>
            </tr>
            }
        </tbody>
    </table>
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="copyToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <img src="..." class="rounded me-2" alt="...">
                <strong class="me-auto">ToDo application</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                ToDo item copied to clipboard.
            </div>
        </div>
    </div>
</div>